import{_ as s,o as a,c as l,a as n}from"./app.57a3dbd1.js";const e="/assets/ios1.79c479c1.png",o="/assets/ios2.f422d7f7.png",p="/assets/ios3.188ef65f.png",u=JSON.parse('{"title":"iOS 设备接入","description":"","frontmatter":{"contributors":["ZhouYixun","soniclei","shinyvince"]},"headers":[{"level":2,"title":"接入通用配置","slug":"接入通用配置","link":"#接入通用配置","children":[]},{"level":2,"title":"iOS16 特殊配置","slug":"ios16-特殊配置","link":"#ios16-特殊配置","children":[]},{"level":2,"title":"构建 WebDriverAgent 到设备中","slug":"构建-webdriveragent-到设备中","link":"#构建-webdriveragent-到设备中","children":[]},{"level":2,"title":"构建 ipa 文件","slug":"构建-ipa-文件","link":"#构建-ipa-文件","children":[]},{"level":2,"title":"常见问题（Q&A）","slug":"常见问题-q-a","link":"#常见问题-q-a","children":[]}],"relativePath":"deploy/ios-deploy.md","lastUpdated":1716537034000}'),t={name:"deploy/ios-deploy.md"},i=n(`<h1 id="ios-设备接入" tabindex="-1">iOS 设备接入 <a class="header-anchor" href="#ios-设备接入" aria-hidden="true">#</a></h1><p>本文将介绍 iOS 设备接入 Sonic 的准备工作。</p><h2 id="接入通用配置" tabindex="-1">接入通用配置 <a class="header-anchor" href="#接入通用配置" aria-hidden="true">#</a></h2><ol><li>将设备使用 USB 连接电脑</li><li>点击【信任】电脑</li><li>将 WebDriverAgent 构建到设备中（首次连接需要，可参考下方构建教学）</li><li>网页调试相关设置：设置 → Safari浏览器 → 高级 → 打开【网页检查器】</li><li>关闭手机锁屏密码：设置 → 面容ID与密码 → 关闭密码（不关闭可能出现远程使用时sonic一直显示连接中且手机阻塞在输入密码页）</li></ol><h2 id="ios16-特殊配置" tabindex="-1">iOS16 特殊配置 <a class="header-anchor" href="#ios16-特殊配置" aria-hidden="true">#</a></h2><p>iOS16 需要手动开启开发者选项。</p><ol><li>打开设置，进入【隐私与安全性】。</li><li>点击【开发者模式】。</li><li>如果出现提示重启弹窗，点击重启。</li><li>如果启动后询问是否打开开发者模式，点击打开。</li></ol><h2 id="构建-webdriveragent-到设备中" tabindex="-1">构建 WebDriverAgent 到设备中 <a class="header-anchor" href="#构建-webdriveragent-到设备中" aria-hidden="true">#</a></h2><p>构建 wda 到你的 iOS 设备中。</p><div class="tip custom-block"><p class="custom-block-title">注意</p><p>构建成功后即可脱离 Mac，在 Windows 或 Linux 的 Agent 上也可以使用 iOS 设备。准备个人免费证书（7 天过期），最好还是使用开发者账户。</p></div><p>准备工作：Mac、Xcode、开发者账户。</p><ol><li>拉取 Sonic组织的WebDriverAgent 项目。（该项目对应为appium/WebDriverAgent的v6.1.1版本，因为7.x开始有部分触控API破坏性更新，因此Sonic组织暂时保留这个版本为基础）</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">git</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">clone</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://github.com/SonicCloudOrg/sonic-ios-wda.git</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>修改 <strong>WebDriverAgentLib</strong> 和 <strong>WebDriverAgentRunner</strong> 中的 Signing Team 为自己的开发者账号。</li></ol><p><img src="`+e+'" alt="ios1"></p><ol start="3"><li>修改 <strong>WebDriverAgentRunner</strong> 中 Build Settings 中的 <strong>Product Bundle Identifier</strong> 为自己的自定义包名（最好保留 WebDriverAgentRunner 结尾）</li></ol><p><img src="'+o+'" alt="ios2"></p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>部分 Xcode 版本在修改包名后会重置签名的 Team，需重新更改第二步中的签名</p></div><ol start="4"><li>Scheme 选择 <strong>WebDriverAgentRunner</strong> 作为构建目标，右侧选择目标设备。然后选择 Product -&gt; Build 即可构建。如果想测试 WebDriverAgent 是否能正常运行，也可以选择 Product -&gt; Test 查看运行日志。</li></ol><p><img src="'+p+`" alt="ios3"></p><div class="warning custom-block"><p class="custom-block-title">注意</p><p>如果构建到手机上有错误，可能是因为没有信任证书引起的。请连接网络后，在设置--通用--描述文件与管理里面信任即可。</p></div><ol start="5"><li>构建完成！可以前往 Agent 端 config 文件夹的 yml 文件中配置对应的自定义 BundleId 即可。</li></ol><div class="tip custom-block"><p class="custom-block-title">注意</p><p>接入完成后，后续可以脱离 Mac 来使用 iOS（Windows 需要安装 iTunes），如果证书过期，需要重新使用 Mac 安装证书</p></div><h2 id="构建-ipa-文件" tabindex="-1">构建 ipa 文件 <a class="header-anchor" href="#构建-ipa-文件" aria-hidden="true">#</a></h2><p>如果只想构建一次，然后打包成 wda.ipa 共享给其他设备，可以参考这个方式。</p><p>手机 udId 必须在开发者账号下。</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">xcodebuild</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build-for-testing</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-scheme</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">WebDriverAgentRunner</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-sdk</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">iphoneos</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-configuration</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Release</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-derivedDataPath</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/tmp/derivedDataPath</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/tmp/derivedDataPath</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">cd</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Build/Products/Release-iphoneos</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Payload</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">mv</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">*</span><span style="color:#C3E88D;">.app</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Payload</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">zip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-r</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">WDA.ipa</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Payload</span></span>
<span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sib</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">app</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">WDA.ipa</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>关于 sib 的使用，可前往周边生态。</p></div><h2 id="常见问题-q-a" tabindex="-1">常见问题（Q&amp;A） <a class="header-anchor" href="#常见问题-q-a" aria-hidden="true">#</a></h2><p>Q1: 打包 wda 后启动失败。</p><p>A1: 请检查 yml 中配置的 bundleId 是否一致、设备是否信任了证书、设备是否信任了电脑。</p><hr><p>Q2: 使用后没有出现画面，但是按键操作正常。</p><p>A1: 解决方案可参考 <a href="https://sonic-cloud.wiki/d/27-ios" target="_blank" rel="noreferrer">这个帖子</a>。</p><hr><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>更多疑问可前往 👉<a href="https://discord.gg/c9ZD6jSyTE" target="_blank" rel="noreferrer">社区</a>👈 交流</p></div>`,36),r=[i];function c(d,C,A,y,D,h){return a(),l("div",null,r)}const b=s(t,[["render",c]]);export{u as __pageData,b as default};
