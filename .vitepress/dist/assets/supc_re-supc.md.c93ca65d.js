import{_ as s,o as a,c as n,a as l}from"./app.57a3dbd1.js";const C=JSON.parse('{"title":"sonic-uiautomator2-python-client","description":"","frontmatter":{"contributors":["ZhouYixun"]},"headers":[{"level":2,"title":"本仓库贡献者","slug":"本仓库贡献者","link":"#本仓库贡献者","children":[]},{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"如何使用","slug":"如何使用","link":"#如何使用","children":[{"level":3,"title":"致谢","slug":"致谢","link":"#致谢","children":[]}]}],"relativePath":"supc/re-supc.md","lastUpdated":1716537034000}'),o={name:"supc/re-supc.md"},p=l(`<h1 id="sonic-uiautomator2-python-client" tabindex="-1">sonic-uiautomator2-python-client <a class="header-anchor" href="#sonic-uiautomator2-python-client" aria-hidden="true">#</a></h1><p>本文为sonic-uiautomator2-python-client的介绍与原理简述。 👉<a href="https://github.com/SonicCloudOrg/sonic-uiautomator2-python-client" target="_blank" rel="noreferrer">Github地址</a></p><div style="display:flex;"><img src="https://img.shields.io/github/stars/SonicCloudOrg/sonic-uiautomator2-python-client?style=social"><img style="margin-left:10px;" src="https://img.shields.io/github/forks/SonicCloudOrg/sonic-uiautomator2-python-client?style=social"><img style="margin-left:10px;" src="https://img.shields.io/pypi/v/sonic-uia2-client"><img style="margin-left:10px;" src="https://img.shields.io/pypi/dm/sonic-uia2-client"></div><h2 id="本仓库贡献者" tabindex="-1">本仓库贡献者 <a class="header-anchor" href="#本仓库贡献者" aria-hidden="true">#</a></h2><a href="https://github.com/SonicCloudOrg/sonic-uiautomator2-python-client/graphs/contributors"><img src="https://contrib.rocks/image?repo=SonicCloudOrg/sonic-uiautomator2-python-client"></a><h2 id="介绍" tabindex="-1">介绍 <a class="header-anchor" href="#介绍" aria-hidden="true">#</a></h2><p>目前Sonic的自动化依赖了 <a href="https://github.com/appium/appium-uiautomator2-server" target="_blank" rel="noreferrer">appium-uiautomator2-server</a>，但是我们绕开了Appium Server来直接使用。</p><p>考虑到有IDE用户想直接调用uia远程url的使用场景，我们进行了预研，发现Github上只看到一个Python绕开Appium Server单独跟appium-uiautomator2-server交互的项目 <a href="https://github.com/xsoloking/appium-uiautomator2-client" target="_blank" rel="noreferrer">appium-uiautomator2-client</a>，但是未能兼容最新appium-uiautomator2-server v5.x API的baseUrl，并且没有发布在pypi。尝试过跟作者接触但是没有回复，于是决定组织自己写一个维护。</p><p>Java版本的可以看我们组织自己维护的 <a href="https://github.com/SonicCloudOrg/sonic-driver-core" target="_blank" rel="noreferrer">sonic-driver-core</a>。</p><h2 id="如何使用" tabindex="-1">如何使用 <a class="header-anchor" href="#如何使用" aria-hidden="true">#</a></h2><ol><li>安装uia2 server</li></ol><blockquote><p>你需要先安装 <code>sonic-appium-uiautomator2-server.apk</code> 和 <code>sonic-appium-uiautomator2-server-test.apk</code> ，可以从这里下载 <a href="https://github.com/SonicCloudOrg/sonic-agent/tree/main/plugins" target="_blank" rel="noreferrer">这里</a>.</p><p>当然你也可以自己构建 <a href="https://github.com/SonicCloudOrg/sonic-appium-uiautomator2-server" target="_blank" rel="noreferrer">前往这里</a></p></blockquote><ol start="2"><li>启动 uiautomator2 server</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">adb</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">shell</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">am</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">instrument</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-w</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">io.appium.uiautomator2.server.test/androidx.test.runner.AndroidJUnitRunner</span></span>
<span class="line"></span></code></pre></div><ol start="3"><li>转发端口</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">adb</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">forward</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp:</span><span style="color:#F78C6C;">6790</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">tcp:</span><span style="color:#F78C6C;">6790</span></span>
<span class="line"></span></code></pre></div><ol start="4"><li>安装依赖</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">pip</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-U</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sonic-uia2-client</span></span>
<span class="line"></span></code></pre></div><ol start="5"><li>编写你的脚本</li></ol><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> common</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> AndroidSelector</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> uia2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">driver </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> AndroidDriver</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">TestDriver</span><span style="color:#89DDFF;">:</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">uia_url</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:6790</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">adb_serial_num</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">DAISKnlasido</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">package_name</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">com.android.settings</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test_demo</span><span style="color:#89DDFF;">(</span><span style="color:#F07178;font-style:italic;">self</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># launch App</span></span>
<span class="line"><span style="color:#A6ACCD;">        os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">system</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">adb -s </span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;"> shell monkey -p </span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;"> -c android.intent.category.LAUNCHER 1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">adb_serial_num</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                                                                                        </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">package_name</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#676E95;font-style:italic;"># connect remote uia2 server</span></span>
<span class="line"><span style="color:#A6ACCD;">        driver </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AndroidDriver</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">uia_url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> driver</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_page_source</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">p</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        e </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> driver</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find_element</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">AndroidSelector</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">XPATH</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">//*[@text=&#39;设置&#39;]</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> e </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_text</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">            e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send_keys</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="致谢" tabindex="-1">致谢 <a class="header-anchor" href="#致谢" aria-hidden="true">#</a></h3><ul><li><a href="https://github.com/appium/appium-uiautomator2-server" target="_blank" rel="noreferrer">appium/appium-uiautomator2-server</a></li><li><a href="https://github.com/xsoloking/appium-uiautomator2-client" target="_blank" rel="noreferrer">xsoloking/appium-uiautomator2-client</a></li></ul>`,22),e=[p];function t(r,c,i,y,D,F){return a(),n("div",null,e)}const A=s(o,[["render",t]]);export{C as __pageData,A as default};
