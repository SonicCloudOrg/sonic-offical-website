import{_ as s,o,c as a,a as e}from"./app.57a3dbd1.js";const l="/assets/eve.56b532f8.jpg",b=JSON.parse('{"title":"Agent 端部署","description":"","frontmatter":{"contributors":["ZhouYixun","soniclei","shinyvince","mmagi"]},"headers":[{"level":2,"title":"jar 方式部署","slug":"jar-方式部署","link":"#jar-方式部署","children":[]},{"level":2,"title":"Docker 部署","slug":"docker-部署","link":"#docker-部署","children":[]},{"level":2,"title":"常见问题（Q&A）","slug":"常见问题-q-a","link":"#常见问题-q-a","children":[]}],"relativePath":"deploy/agent-deploy.md","lastUpdated":1716537034000}'),t={name:"deploy/agent-deploy.md"},n=e(`<h1 id="agent-端部署" tabindex="-1">Agent 端部署 <a class="header-anchor" href="#agent-端部署" aria-hidden="true">#</a></h1><p>本文将介绍如何部署 Agent 端。</p><div class="tip custom-block"><p class="custom-block-title">注意</p><p>谨记一个主机只能部署一个 Agent 端，每个 Agent 的 Key 不能重复使用，多台设备可接入同一 Agent。</p><p>为了能正常使用，请保持与server版本一致。</p><p>考虑到远控时带宽消耗以及数据传输速度等场景，建议 Agent 优先使用有线网络环境而不是无线网络。</p></div><h2 id="jar-方式部署" tabindex="-1">jar 方式部署 <a class="header-anchor" href="#jar-方式部署" aria-hidden="true">#</a></h2><p>该方式将以本地 jar 包部署 Agent 端、Appium 等等环境。</p><ol><li><strong>最低启动要求为JDK17</strong>，可以前往 <a href="https://docs.aws.amazon.com/corretto/latest/corretto-17-ug/downloads-list.html" target="_blank" rel="noreferrer">这里</a> 安装下载。</li><li>从部署好的前端界面【设备中心】的【Agent 中心】新增 Agent，记录 Agent 的 Key。</li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>从<code>v2.5.3</code>起，为降低用户部署成本，Agent在<code>plugins</code>文件夹下内置adb。</p><p>但是已知多个adb-server同时工作会出现抢占问题，因此如果你本地有其他adb-server正在工作，希望用自己已有的adb 或 版本低于v2.5.3时，需要加上这两步：</p><ol><li>将安卓 SDK 设置到系统环境变量，命名为 ANDROID_HOME。打开 SDKManager，下载 <strong>platform-tools</strong>。确保 platform-tools 目录存在，adb 指令可用。</li><li>将 ANDROID_HOME、ANDROID_HOME/platform-tools 添加到系统 PATH 中。</li></ol></div><ol start="3"><li>选择 <strong>PC 对应的平台 zip</strong> 下载并解压到任意目录（标记为 <strong>工作目录</strong> ，<strong>如以下加速链接失效</strong>，请自行前往 <a href="https://github.com/SonicCloudOrg/sonic-agent/releases" target="_blank">这里</a> 下载）</li></ol><div class="info custom-block"><p class="custom-block-title">Linux</p><p>👉 <a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/sonic-agent-v2.6.4-linux_x86.zip" target="_blank">sonic-agent-v2.6.4-linux_x86.zip</a></p><p>👉 <a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/sonic-agent-v2.6.4-linux_x86_64.zip" target="_blank">sonic-agent-v2.6.4-linux_x86_64.zip</a></p><p>👉 <a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/sonic-agent-v2.6.4-linux_arm64.zip" target="_blank">sonic-agent-v2.6.4-linux_arm64.zip</a></p></div><div class="info custom-block"><p class="custom-block-title">Macosx</p><p>👉 <a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/sonic-agent-v2.6.4-macosx_x86_64.zip" target="_blank">sonic-agent-v2.6.4-macosx_x86_64.zip</a></p><p>👉 <a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/sonic-agent-v2.6.4-macosx_arm64.zip" target="_blank">sonic-agent-v2.6.4-macosx_arm64.zip</a></p></div><div class="info custom-block"><p class="custom-block-title">Windows</p><p>👉 <a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/sonic-agent-v2.6.4-windows_x86.zip" target="_blank">sonic-agent-v2.6.4-windows_x86.zip</a></p><p>👉 <a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/sonic-agent-v2.6.4-windows_x86_64.zip" target="_blank">sonic-agent-v2.6.4-windows_x86_64.zip</a></p></div><ol start="4"><li>赋予 <strong>工作目录</strong> 所有权限，然后确保解压后的 mini、config、plugins 文件夹与 jar 同级</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">$</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sudo</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-R</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">777</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">xxxxx</span></span>
<span class="line"></span></code></pre></div><ol start="5"><li>修改 config 文件夹中 <strong>application-sonic-agent.yml</strong> 的配置信息，保存。</li><li>在 <strong>工作目录</strong> 路径下执行以下指令。</li></ol><div class="tip custom-block"><p class="custom-block-title">TIP</p><ol><li>如果你是 <code>Windows</code> 用户，请先在控制台输入 <code>chcp 65001</code> 并回车，再输入以下指令</li></ol><p>此外，如需使用Python自定义脚本功能，还请 <strong>再</strong> 输入 <code>set PYTHONIOENCODING=UTF-8</code> 并回车，以避免Python脚本输出内容乱码</p><ol start="2"><li>如果你是 <code>Macosx</code> 用户，请查看下方常见问题Q1进行配置后再继续执行下方指令</li></ol></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">java</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-Dfile.encoding=utf-8</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-jar</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">sonic-agent-xxxx.jar</span></span>
<span class="line"></span></code></pre></div><ol start="7"><li>部署完毕！可以前往设备接入文档（设备请竖直放置或平摊放置，左右旋转放置有可能影响坐标定位）。</li></ol><h2 id="docker-部署" tabindex="-1">Docker 部署 <a class="header-anchor" href="#docker-部署" aria-hidden="true">#</a></h2><div class="danger custom-block"><p class="custom-block-title">警告</p><p>Docker部署仅 Ubuntu 可用！仅 Ubuntu 可用！仅 Ubuntu 可用！</p><p>非Ubuntu系统请使用上方 <strong>jar方式部署</strong>！</p></div><p>该方式将一次性部署 Agent 端以及所需环境。</p><p>准备工作：Docker，Sonic 前后端部署完毕</p><ol><li>从部署好的前端界面【设备中心】的【Agent 中心】新增 Agent，记录 Agent 的 Key。</li><li><a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/docker-compose.yml" target="_blank" rel="noreferrer">点击这里</a> 下载最新的docker-compose.yml，参考注释修改里面的内容。（如加速链接失效，请自行前往 <a href="https://github.com/SonicCloudOrg/sonic-agent/releases" target="_black">这里</a> 下载）</li><li>执行以下指令（自行根据提示更改参数）。</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">如果您为中国大陆用户，出现访问DockerHub较慢的情况，可以从以下两点选择一个进行操作：</p><ul><li>配置国内加速镜像源（推荐）</li><li><a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-agent/releases/download/v2.6.4/docker-compose-zh.yml" target="_blank">点击这里</a> 下载docker-compose-zh.yml后执行以下指令直接使用加速镜像（不推荐，加速源可能出现不稳定或网络波动，后续down的时候需要docker-compose -f docker-compose-zh.yml down）</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-compose-zh.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span>
<span class="line"></span></code></pre></div></div><ol start="4"><li>部署完毕！可以前往设备接入文档。</li><li>(附) 如果您对Docker不熟悉，更推荐使用jar方式部署。</li></ol><h2 id="常见问题-q-a" tabindex="-1">常见问题（Q&amp;A） <a class="header-anchor" href="#常见问题-q-a" aria-hidden="true">#</a></h2><p>Q1: Mac上部署有什么注意的吗？</p><p>A1: 需要信任Sonic的来源，不然部分插件无法正常启动。</p><ol><li>终端输入</li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">sudo spctl --master-disable</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ol start="2"><li>【安全性与隐私】将任何来源权限放开。 <img src="`+l+'" alt="eve"></li></ol><hr><p>Q2: 明明配置好了 ANDROID_HOME，并且 adb 可用，为什么还是检测不到 ANDROID_HOME？</p><p>A2: 需要配置好 ANDROID_HOME 之后，PATH 里面也需要配置好。确认 <code>echo %ANDROID_HOME%</code> (win) 或 <code>echo $ANDROID_HOME</code> (mac 或 linux) 输出正确。</p><hr><p>Q3: 查看日志发现与 Server 没有连上，该怎么解决？</p><p>A3: 主要分为多种情况:</p><ol><li>Key 配置不正确，一个 Key 只能一个 Agent 使用。</li><li>所有 ip 不能使用 localhost、127.0.0.1 之类的配置。</li></ol><hr><p>Q4: 查看日志发现时区不对，宿主机的时区没有问题，该怎么解决？</p><p>A4: 可以参考 <a href="https://sonic-cloud.wiki/d/2297" target="_blank" rel="noreferrer">这个帖子</a></p><hr><p>Q5: Mac上启动会有sonic-android-supply或其他插件安全弹窗？</p><p>A5: 建议还是按照上方Q1的解答解决最佳，除此之外可以这样解决 Mac：系统偏好设置 -&gt; 安全性与隐私 -&gt; 通用，点击信任或仍要打开。</p><hr><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>更多疑问可前往 👉<a href="https://discord.gg/c9ZD6jSyTE" target="_blank" rel="noreferrer">社区</a>👈 交流</p></div>',46),c=[n];function p(i,r,d,g,h,u){return o(),a("div",null,c)}const C=s(t,[["render",p]]);export{b as __pageData,C as default};
