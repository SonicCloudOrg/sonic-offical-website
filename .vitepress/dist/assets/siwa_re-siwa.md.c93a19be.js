import{_ as s,o as n,c as a,a as o}from"./app.57a3dbd1.js";const l="/assets/siwa-design.5784da0f.png",p="/assets/siwa-api-diff.77f2d45a.png",d=JSON.parse('{"title":"sonic-ios-webkit-adapter","description":"","frontmatter":{"contributors":["aoliaoaoaojiao","ZhouYixun"]},"headers":[{"level":2,"title":"本仓库贡献者","slug":"本仓库贡献者","link":"#本仓库贡献者","children":[]},{"level":2,"title":"介绍","slug":"介绍","link":"#介绍","children":[]},{"level":2,"title":"快速使用","slug":"快速使用","link":"#快速使用","children":[]},{"level":2,"title":"iOS web 测试基础原理浅谈","slug":"ios-web-测试基础原理浅谈","link":"#ios-web-测试基础原理浅谈","children":[]},{"level":2,"title":"如何开启 iOS web debug 服务？","slug":"如何开启-ios-web-debug-服务","link":"#如何开启-ios-web-debug-服务","children":[]},{"level":2,"title":"协议兼容","slug":"协议兼容","link":"#协议兼容","children":[{"level":3,"title":"案例","slug":"案例","link":"#案例","children":[]},{"level":3,"title":"大体设计","slug":"大体设计","link":"#大体设计","children":[]},{"level":3,"title":"不同调试协议之间的API 差异 概览","slug":"不同调试协议之间的api-差异-概览","link":"#不同调试协议之间的api-差异-概览","children":[]}]}],"relativePath":"siwa/re-siwa.md","lastUpdated":1716537034000}'),e={name:"siwa/re-siwa.md"},t=o(`<h1 id="sonic-ios-webkit-adapter" tabindex="-1">sonic-ios-webkit-adapter <a class="header-anchor" href="#sonic-ios-webkit-adapter" aria-hidden="true">#</a></h1><p>本文为用于谷歌浏览器调试的 webkit 协议接收器 sonic-ios-webkit-adapter 的介绍与原理简述。 👉<a href="https://github.com/SonicCloudOrg/sonic-ios-webkit-adapter" target="_blank" rel="noreferrer">Github 地址</a></p><div style="display:flex;"><img src="https://img.shields.io/github/stars/SonicCloudOrg/sonic-ios-webkit-adapter?style=social"><img style="margin-left:10px;" src="https://img.shields.io/github/forks/SonicCloudOrg/sonic-ios-webkit-adapter?style=social"></div><h2 id="本仓库贡献者" tabindex="-1">本仓库贡献者 <a class="header-anchor" href="#本仓库贡献者" aria-hidden="true">#</a></h2><a href="https://github.com/SonicCloudOrg/sonic-ios-webkit-adapter/graphs/contributors"><img src="https://contrib.rocks/image?repo=SonicCloudOrg/sonic-ios-webkit-adapter"></a><h2 id="介绍" tabindex="-1">介绍 <a class="header-anchor" href="#介绍" aria-hidden="true">#</a></h2><p><strong>sonic-ios-webkit-adapter</strong> 用作 iOS H5 自动化的底层框架，如 auto touch、性能采集等， 以及提供给前端一个开源易用的 iOS webdebug tool，而如果不使用 adapter，则是暴露原生的 iOS webkit ws 服务， 可以通过 iOS webkit debug tool 工具进行调试（参考： <a href="https://github.com/p0358/webkit-webinspector" target="_blank" rel="noreferrer">webkit-webinspector</a> ），在后续版本中，我们将会对 devtool 进行二次开发，完善 sonic 的 H5 自动化前端。</p><h2 id="快速使用" tabindex="-1">快速使用 <a class="header-anchor" href="#快速使用" aria-hidden="true">#</a></h2><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">go</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">get</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-u</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">github.com/SonicCloudOrg/sonic-ios-webkit-adapter</span></span>
<span class="line"></span></code></pre></div><h2 id="ios-web-测试基础原理浅谈" tabindex="-1">iOS web 测试基础原理浅谈 <a class="header-anchor" href="#ios-web-测试基础原理浅谈" aria-hidden="true">#</a></h2><p>当前的主流 H5 调试，基本上都是基于浏览器开放的 debug ws 服务来进行的。我们通过连接这些 ws，然后发送对应的协议过去，即可达到 debug 的目的，例如 iOS 获取 elements，则需要按照协议通过 ws 发送 getDocument 方法到 webkit 里面，等待 ws server 返回对应的 element 信息。iOS 的 webkit protocol 详细可参考：<a href="https://github.com/WebKit/webkit/tree/main/Source/JavaScriptCore/inspector/protocol" target="_blank" rel="noreferrer">WebKit/Source/JavaScriptCore/inspector/protocol at main · WebKit/WebKit · GitHub</a> ，里面通过划分域的形式，已经将协议分为主要的 20-30 个文件。</p><h2 id="如何开启-ios-web-debug-服务" tabindex="-1">如何开启 iOS web debug 服务？ <a class="header-anchor" href="#如何开启-ios-web-debug-服务" aria-hidden="true">#</a></h2><p>不同于安卓只需要简单的去开发者模式里开启 webview 的 debug 模式，iOS 由于其封闭性，开启 web debug 非常麻烦。我们需要发送相关的 DTX 协议给 iOS 内置的 com.apple.webinspector（参考:<a href="https://github.com/SonicCloudOrg/sonic-gidevice/blob/main/webinspector.go" target="_blank" rel="noreferrer">sonic-gidevice/webinspector.go at main · SonicCloudOrg/sonic-gidevice · GitHub</a> 、<a href="https://github.com/SonicCloudOrg/sonic-ios-bridge/tree/main/src/webinspector" target="_blank" rel="noreferrer">sonic-ios-bridge/src/webinspector at main · SonicCloudOrg/sonic-ios-bridge · GitHub</a> ）。</p><p>大体流程如下：通过 gidevice 启动相关的 webinspector server 方法，随后 DTX 发送对应的<strong>connect id</strong>到 webinspector，</p><p>这时候会返回对应的 DTX 信息，我们会根据 DTX 信息的 case 标志(Selector 参数)进行 webinspector client 的初始化处理。</p><p>该过程中会得到当前设备中的 webkit<strong>应用 pid 和 base page 信息</strong>（根据一些技术文章，如果 iOS 的应用有 developer 证书，则可以开启 H5 调试，后续开发维护时会进行验证其真实性）。根据这些 pid 和 page 信息，当需要对某个 webkit 应用进行 web debug 时，创建一个<strong>senderid</strong>，并将其发送到 webinspector 中，<strong>让 webkit 开启 debug 服务</strong>，我们只需要发送相关的协议信息就行。</p><h2 id="协议兼容" tabindex="-1">协议兼容 <a class="header-anchor" href="#协议兼容" aria-hidden="true">#</a></h2><p>虽然 iOS 的 webkit inspector 是发展最早的一个网页调试器，但是由于 iOS 的封闭性和其他的一些因素，后续的其他内核的浏览器调试并没有使用 iOS 的 webkit 调试协议，基于易用性考虑，sonic 参考<a href="https://github.com/google/ios-webkit-debug-proxy" target="_blank" rel="noreferrer">google/ios-webkit-debug-proxy</a> 、<a href="https://github.com/RemoteDebug/remotedebug-ios-webkit-adapter" target="_blank" rel="noreferrer">RemoteDebug/remotedebug-ios-webkit-adapter</a> 这两个项目，用 golang 重写了一遍，只需要使用 sib 的 webinspector adapter 模式，即可通过 chrome devtool 简单调试 iOS 的 safari。核心思路是 sib 将发送协议信息这个关键步骤做成 ws 服务，采用双向代理的模式，通过<a href="https://github.com/SonicCloudOrg/sonic-ios-webkit-adapter" target="_blank" rel="noreferrer">SonicCloudOrg/sonic-ios-webkit-adapter</a> <strong>拦截 iOS webkit 调试协议和 Chrome DevTools Protocol 协议之间的特异方法，将其转换成双方可接受的调试协议和返回结果</strong>。</p><h3 id="案例" tabindex="-1">案例 <a class="header-anchor" href="#案例" aria-hidden="true">#</a></h3><p>如果我们需要获取当前页面下导航栏中的历史信息时，Chrome DevTools Protocol 的做法是 ws 里发送 Page 域中的 getNavigationHistory 方法到当前调试的应用中，等待返回的结果就行。比较可惜的是，这个方法直接发送到 iOS webkit 中，iOS webkit 会返回信息告知并没有这个方法，不过 iOS webkit 可以通过曲线救国的方式达到类似的效果。首先，我们先看 Chrome DevTools Protocol 中 getNavigationHistory 的返回信息是什么（参考：<a href="https://github.com/ChromeDevTools/devtools-protocol/blob/master/json/browser_protocol.json" target="_blank" rel="noreferrer">Chrome Devtools Protocol</a> ）</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">TransitionType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Transition type.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">enum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">link</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">typed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">address_bar</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">auto_bookmark</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">auto_subframe</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">manual_subframe</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">generated</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">auto_toplevel</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">form_submit</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">reload</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">keyword</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">keyword_generated</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">            &quot;</span><span style="color:#C3E88D;">other</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">getNavigationHistory</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Returns navigation history for the current page.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">returns</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">            {</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">currentIndex</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Index of the current navigation history entry.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">integer</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            },</span></span>
<span class="line"><span style="color:#A6ACCD;">            {</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">entries</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Array of navigation history entries.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">array</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">items</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: {</span></span>
<span class="line"><span style="color:#89DDFF;">                    &quot;</span><span style="color:#A6ACCD;">$ref</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">NavigationEntry</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">                }</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">NavigationEntry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Navigation history entry.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">object</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">        &quot;</span><span style="color:#C3E88D;">properties</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">            {</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Unique id of the navigation history entry.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">integer</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            },</span></span>
<span class="line"><span style="color:#A6ACCD;">            {</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">url</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">URL of the navigation history entry.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            },</span></span>
<span class="line"><span style="color:#A6ACCD;">            {</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">userTypedURL</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">URL that the user typed in the url bar.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            },</span></span>
<span class="line"><span style="color:#A6ACCD;">            {</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">title</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Title of the navigation history entry.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">type</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            },</span></span>
<span class="line"><span style="color:#A6ACCD;">            {</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">transitionType</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#C3E88D;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">Transition type.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#89DDFF;">                &quot;</span><span style="color:#A6ACCD;">$ref</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;"> &quot;</span><span style="color:#C3E88D;">TransitionType</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            }</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>由返回结构可知，最重要的是 url 和 titile（其他信息可自定义生成），所以思路可以这样：</p><p>通过中间层拦截到这个特异性的方法，然后将这个方法替换成 iOS webkit protocol 下 Runtime 域的 evaluate 方法（evaluate 方法的使用说明参考：<a href="https://github.com/WebKit/WebKit/blob/main/Source/JavaScriptCore/inspector/protocol/Runtime.json" target="_blank" rel="noreferrer">iOS webkit protocol Runtime</a>），发送 window.location.href，获取全局 windows 对象下的 location.href 结果，然后再次使用 Runtime 域 evaluate 方法，发送 window.title，获取全局 windows 对象下的 title 结果，然后按照 getNavigationHistory 的返回结构组合获取到的这些信息，再返回到 devtool 中。</p><h3 id="大体设计" tabindex="-1">大体设计 <a class="header-anchor" href="#大体设计" aria-hidden="true">#</a></h3><p><img src="`+l+'" alt="siwa-design"></p><h3 id="不同调试协议之间的api-差异-概览" tabindex="-1">不同调试协议之间的<a href="http://compatibility.remotedebug.org/" target="_blank" rel="noreferrer">API 差异</a> 概览 <a class="header-anchor" href="#不同调试协议之间的api-差异-概览" aria-hidden="true">#</a></h3><p><img src="'+p+'" alt="siwa-api-diff"></p>',27),r=[t];function c(D,i,y,F,C,u){return n(),a("div",null,r)}const b=s(e,[["render",c]]);export{d as __pageData,b as default};
